<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Trabalhos Freelancer</title>
    <!-- SheetJS para trabalhar com Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #4facfe;
        }

        .form-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }

        .btn-danger:hover {
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
        }

        .table-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .table-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h2 {
            margin: 0;
        }

        .stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: rgba(255,255,255,0.2);
            padding: 10px 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e1e5e9;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .whatsapp-section {
            background: #25D366;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }

        .whatsapp-section h3 {
            margin-bottom: 15px;
        }

        .whatsapp-btn {
            background: white;
            color: #25D366;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .whatsapp-btn:hover {
            transform: scale(1.05);
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .stats {
                flex-direction: column;
            }
            
            table {
                font-size: 14px;
            }
            
            th, td {
                padding: 10px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üíº Controle de Trabalhos Freelancer</h1>
            <p>Organize seus trabalhos, pagamentos e horas trabalhadas</p>
        </div>

        <div class="content">
            <!-- Formul√°rio para adicionar novo trabalho -->
            <div class="form-section">
                <h2>‚ûï Adicionar Novo Trabalho</h2>
                <form id="workForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="date">Data do Trabalho:</label>
                            <input type="date" id="date" required>
                        </div>
                        <div class="form-group">
                            <label for="company">Nome da Empresa:</label>
                            <input type="text" id="company" placeholder="Ex: Tech Solutions" required>
                        </div>
                        <div class="form-group">
                            <label for="hours">Horas Trabalhadas:</label>
                            <input type="number" id="hours" step="0.5" placeholder="Ex: 4" required>
                        </div>
                        <div class="form-group">
                            <label for="value">Valor Recebido (R$):</label>
                            <input type="number" id="value" step="0.01" placeholder="Ex: 70.00" required>
                        </div>
                        <div class="form-group">
                            <label for="paymentDate">Data do Pagamento:</label>
                            <input type="date" id="paymentDate" required>
                        </div>
                        <div class="form-group">
                            <label for="account">Conta que Recebeu:</label>
                            <select id="account" required>
                                <option value="">Selecione a conta</option>
                                <option value="PIX">PIX</option>
                                <option value="Conta Corrente">Conta Corrente</option>
                                <option value="Poupan√ßa">Poupan√ßa</option>
                                <option value="Cart√£o">Cart√£o</option>
                                <option value="Dinheiro">Dinheiro</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn">‚ûï Adicionar Trabalho</button>
                </form>
            </div>

            <!-- Estat√≠sticas -->
            <div class="table-container">
                <div class="table-header">
                    <h2>üìä Resumo dos Trabalhos</h2>
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-value" id="totalValue">R$ 0,00</div>
                            <div class="stat-label">Total Recebido</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalHours">0h</div>
                            <div class="stat-label">Horas Trabalhadas</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalDays">0</div>
                            <div class="stat-label">Dias Trabalhados</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="avgValue">R$ 0,00</div>
                            <div class="stat-label">Valor M√©dio/Hora</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabela de trabalhos -->
            <div class="table-container" style="margin-top: 20px;">
                <div class="table-header">
                    <h2>üìã Lista de Trabalhos</h2>
                </div>
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Empresa</th>
                                <th>Horas</th>
                                <th>Valor</th>
                                <th>Pagamento</th>
                                <th>Conta</th>
                                <th>Dias para Pagar</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="workTableBody">
                            <!-- Dados ser√£o inseridos aqui via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Bot√µes de exporta√ß√£o e importa√ß√£o -->
            <div class="export-buttons">
                <button class="btn" onclick="exportToExcel()">üìà Exportar Excel</button>
                <button class="btn" onclick="exportToCSV()">üìä Exportar CSV</button>
                <button class="btn" onclick="document.getElementById('importFile').click()">üì• Importar Excel</button>
                <button class="btn" onclick="clearAllData()">üóëÔ∏è Limpar Tudo</button>
            </div>

            <!-- Input oculto para importa√ß√£o -->
            <input type="file" id="importFile" accept=".xlsx,.xls" style="display: none;" onchange="importFromExcel(event)">

            <!-- Se√ß√£o de Importa√ß√£o -->
            <div class="form-section" style="background: #e8f5e8; border-left-color: #28a745;">
                <h2>üì• Importar Dados</h2>
                <p><strong>Como importar seus dados:</strong></p>
                <ol style="margin: 15px 0; padding-left: 20px;">
                    <li>Exporte seus dados atuais clicando em "üìà Exportar Excel"</li>
                    <li>Edite o arquivo Excel (.xlsx) no Microsoft Excel ou Google Sheets</li>
                    <li>Salve o arquivo modificado</li>
                    <li>Clique em "üì• Importar Excel" e selecione o arquivo</li>
                    <li>Escolha se quer adicionar ou substituir os dados</li>
                </ol>
                <p style="color: #666; font-size: 0.9em;">
                    üí° <strong>Dica:</strong> Sempre fa√ßa backup exportando seus dados antes de importar novos!
                </p>
            </div>

            <!-- Se√ß√£o WhatsApp -->
            <div class="whatsapp-section">
                <h3>üì± Compartilhar via WhatsApp</h3>
                <p>Envie um resumo dos seus trabalhos para clientes ou para voc√™ mesmo</p>
                <button class="whatsapp-btn" onclick="shareViaWhatsApp()">
                    üì± Compartilhar Resumo
                </button>
            </div>
        </div>
    </div>

    <script>
        // Array para armazenar os trabalhos
        let works = JSON.parse(localStorage.getItem('freelancerWorks')) || [];

        // Elementos do formul√°rio
        const form = document.getElementById('workForm');
        const workTableBody = document.getElementById('workTableBody');

        // Inicializar a aplica√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            loadWorks();
            updateStats();
            
            // Definir data atual como padr√£o
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            document.getElementById('paymentDate').value = today;
        });

        // Adicionar novo trabalho
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const work = {
                id: Date.now(),
                date: document.getElementById('date').value,
                company: document.getElementById('company').value,
                hours: parseFloat(document.getElementById('hours').value),
                value: parseFloat(document.getElementById('value').value),
                paymentDate: document.getElementById('paymentDate').value,
                account: document.getElementById('account').value
            };

            // Calcular dias para pagamento
            const workDate = new Date(work.date);
            const paymentDate = new Date(work.paymentDate);
            work.daysToPayment = Math.ceil((paymentDate - workDate) / (1000 * 60 * 60 * 24));

            works.push(work);
            saveWorks();
            loadWorks();
            updateStats();
            form.reset();
            
            // Definir data atual como padr√£o novamente
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            document.getElementById('paymentDate').value = today;
        });

        // Carregar trabalhos na tabela
        function loadWorks() {
            workTableBody.innerHTML = '';
            
            works.forEach(work => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(work.date)}</td>
                    <td>${work.company}</td>
                    <td>${work.hours}h</td>
                    <td>R$ ${work.value.toFixed(2).replace('.', ',')}</td>
                    <td>${formatDate(work.paymentDate)}</td>
                    <td>${work.account}</td>
                    <td>${work.daysToPayment} dias</td>
                    <td class="actions">
                        <button class="btn btn-small" onclick="editWork(${work.id})">‚úèÔ∏è</button>
                        <button class="btn btn-small btn-danger" onclick="deleteWork(${work.id})">üóëÔ∏è</button>
                    </td>
                `;
                workTableBody.appendChild(row);
            });
        }

        // Atualizar estat√≠sticas
        function updateStats() {
            const totalValue = works.reduce((sum, work) => sum + work.value, 0);
            const totalHours = works.reduce((sum, work) => sum + work.hours, 0);
            const totalDays = new Set(works.map(work => work.date)).size;
            const avgValue = totalHours > 0 ? totalValue / totalHours : 0;

            document.getElementById('totalValue').textContent = `R$ ${totalValue.toFixed(2).replace('.', ',')}`;
            document.getElementById('totalHours').textContent = `${totalHours}h`;
            document.getElementById('totalDays').textContent = totalDays;
            document.getElementById('avgValue').textContent = `R$ ${avgValue.toFixed(2).replace('.', ',')}`;
        }

        // Editar trabalho
        function editWork(id) {
            const work = works.find(w => w.id === id);
            if (work) {
                document.getElementById('date').value = work.date;
                document.getElementById('company').value = work.company;
                document.getElementById('hours').value = work.hours;
                document.getElementById('value').value = work.value;
                document.getElementById('paymentDate').value = work.paymentDate;
                document.getElementById('account').value = work.account;
                
                // Remover o trabalho da lista
                works = works.filter(w => w.id !== id);
                saveWorks();
                loadWorks();
                updateStats();
            }
        }

        // Deletar trabalho
        function deleteWork(id) {
            if (confirm('Tem certeza que deseja deletar este trabalho?')) {
                works = works.filter(work => work.id !== id);
                saveWorks();
                loadWorks();
                updateStats();
            }
        }

        // Salvar trabalhos no localStorage
        function saveWorks() {
            localStorage.setItem('freelancerWorks', JSON.stringify(works));
        }

        // Formatar data
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        // Exportar para CSV
        function exportToCSV() {
            const headers = ['Data', 'Empresa', 'Horas', 'Valor', 'Data Pagamento', 'Conta', 'Dias para Pagar'];
            const csvContent = [
                headers.join(','),
                ...works.map(work => [
                    work.date,
                    `"${work.company}"`,
                    work.hours,
                    work.value,
                    work.paymentDate,
                    `"${work.account}"`,
                    work.daysToPayment
                ].join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `trabalhos_freelancer_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // Exportar para Excel (formato real Excel)
        function exportToExcel() {
            // Criar dados para o Excel
            const excelData = [
                ['Data', 'Empresa', 'Horas', 'Valor', 'Data Pagamento', 'Conta', 'Dias para Pagar'],
                ...works.map(work => [
                    work.date,
                    work.company,
                    work.hours,
                    work.value,
                    work.paymentDate,
                    work.account,
                    work.daysToPayment
                ])
            ];

            // Criar workbook
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(excelData);
            
            // Adicionar formata√ß√£o
            ws['!cols'] = [
                { wch: 12 }, // Data
                { wch: 20 }, // Empresa
                { wch: 8 },  // Horas
                { wch: 12 }, // Valor
                { wch: 12 }, // Data Pagamento
                { wch: 15 }, // Conta
                { wch: 12 }  // Dias para Pagar
            ];

            XLSX.utils.book_append_sheet(wb, ws, 'Trabalhos Freelancer');
            
            // Salvar arquivo
            XLSX.writeFile(wb, `trabalhos_freelancer_${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        // Compartilhar via WhatsApp
        function shareViaWhatsApp() {
            const totalValue = works.reduce((sum, work) => sum + work.value, 0);
            const totalHours = works.reduce((sum, work) => sum + work.hours, 0);
            const totalDays = new Set(works.map(work => work.date)).size;
            
            const message = `üìä *Resumo dos Trabalhos Freelancer*

üí∞ *Total Recebido:* R$ ${totalValue.toFixed(2).replace('.', ',')}
‚è∞ *Horas Trabalhadas:* ${totalHours}h
üìÖ *Dias Trabalhados:* ${totalDays}
üìà *Valor M√©dio por Hora:* R$ ${(totalValue / totalHours).toFixed(2).replace('.', ',')}

üìã *√öltimos Trabalhos:*
${works.slice(-5).map(work => 
    `‚Ä¢ ${formatDate(work.date)} - ${work.company} - ${work.hours}h - R$ ${work.value.toFixed(2).replace('.', ',')}`
).join('\n')}

Gerado em: ${new Date().toLocaleDateString('pt-BR')}`;

            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        // Importar dados do Excel
        function importFromExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Pegar a primeira planilha
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    
                    // Converter para JSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    if (jsonData.length < 2) {
                        alert('‚ùå Arquivo Excel vazio ou inv√°lido!');
                        return;
                    }

                    // Verificar cabe√ßalhos
                    const headers = jsonData[0];
                    if (!headers.includes('Data') || !headers.includes('Empresa')) {
                        alert('‚ùå Arquivo Excel inv√°lido! Certifique-se de que √© um arquivo exportado desta aplica√ß√£o.');
                        return;
                    }

                    const newWorks = [];
                    for (let i = 1; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (row && row.length >= 7 && row[0] && row[1]) {
                            const work = {
                                id: Date.now() + i, // Gerar novo ID
                                date: row[0] ? row[0].toString() : '',
                                company: row[1] ? row[1].toString() : '',
                                hours: parseFloat(row[2]) || 0,
                                value: parseFloat(row[3]) || 0,
                                paymentDate: row[4] ? row[4].toString() : '',
                                account: row[5] ? row[5].toString() : '',
                                daysToPayment: parseInt(row[6]) || 0
                            };
                            
                            // Validar se tem dados m√≠nimos
                            if (work.date && work.company) {
                                newWorks.push(work);
                            }
                        }
                    }

                    if (newWorks.length > 0) {
                        const option = confirm(`üì• Encontrados ${newWorks.length} registros no arquivo.\n\nEscolha uma op√ß√£o:\n\nOK = Adicionar aos dados existentes\nCancelar = Substituir todos os dados`);
                        
                        if (option) {
                            // Adicionar aos dados existentes
                            works = [...works, ...newWorks];
                            alert(`‚úÖ ${newWorks.length} registros adicionados com sucesso!`);
                        } else {
                            // Substituir todos os dados
                            works = newWorks;
                            alert(`‚úÖ ${newWorks.length} registros importados com sucesso!`);
                        }
                        
                        saveWorks();
                        loadWorks();
                        updateStats();
                    } else {
                        alert('‚ùå Nenhum registro v√°lido encontrado no arquivo!');
                    }
                } catch (error) {
                    alert('‚ùå Erro ao processar o arquivo Excel: ' + error.message);
                }
            };
            reader.readAsArrayBuffer(file);
            
            // Limpar o input para permitir selecionar o mesmo arquivo novamente
            event.target.value = '';
        }

        // Limpar todos os dados
        function clearAllData() {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso ir√° deletar TODOS os dados permanentemente. Tem certeza?')) {
                works = [];
                saveWorks();
                loadWorks();
                updateStats();
                alert('‚úÖ Todos os dados foram removidos!');
            }
        }
    </script>
</body>
</html>
